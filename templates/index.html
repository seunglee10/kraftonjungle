<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ë‚˜í™€ë¡œë©”ëª¨ì¥ ver2.0</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Stylish&display=swap" rel="stylesheet">

    <style>
        * {
            font-family: 'Stylish', sans-serif;
        }

        .wrap {
            width: 900px;
            margin: auto;
        }

        .post-box {
            background-color: #e9ecef;
            padding: 40px;
            border-radius: 5px;
            margin-bottom: 30px;
        }

        /* í•µì‹¬: ì„¸ë¡œ ìš°ì„  3ì—´ */
        #card-list {
            column-count: 3;
            column-gap: 1rem;
        }

        .card {
            break-inside: avoid;
            margin-bottom: 12px;
        }

        .link-like {
            cursor: pointer;
            text-decoration: none;
            color: #0d6efd;
        }

    </style>
</head>

<body>
<div class="wrap">
    <!-- ë©”ëª¨ ì‘ì„± -->
    <div class="post-box">
        <h1 class="display-4">
            ë‚˜í™€ë¡œë©”ëª¨ì¥ <span class="badge bg-secondary">ver2.0</span>
        </h1>

        <form action="/memo" method="post" class="mt-4">
            <div class="mb-3 col-md-6">
                <input
                    id="memo-title"
                    name="title"
                    type="text"
                    class="form-control"
                    placeholder="ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”"
                    required
                >
            </div>

            <div class="mb-3 col-md-6">
                <textarea
                    id="memo-content"
                    name="content"
                    class="form-control"
                    rows="3"
                    placeholder="ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”"
                    required
                ></textarea>
            </div>

            <button type="submit" class="btn btn-primary">
                ì €ì¥í•˜ê¸°
            </button>
        </form>
    </div>

    <!-- ë©”ëª¨ ì¹´ë“œ ëª©ë¡ -->
    <div id="card-list">
        {% for memo in memos %}
        <div class="card">
            <div class="card-body">

                {% if edit_id == memo._id %}
                <!-- ìˆ˜ì • ëª¨ë“œ -->
                <div class="edit-form">
                    <input id="edit-title-{{ memo._id }}" class="new-title form-control mb-2" value="{{ memo.title }}">
                    <textarea id="edit-content-{{ memo._id }}" class="new-text form-control mb-2" rows="3">{{ memo.content }}</textarea>
                    <button type="button" onclick="updateMemo('{{ memo._id }}')" class="save-button btn btn-success btn-sm">ì €ì¥</button>
                </div>
                {% else %}
                <!-- ì¼ë°˜ ëª¨ë“œ -->
                <h5 class="card-title">{{ memo.title }}</h5>
                <p class="card-text">{{ memo.content }}</p>

                <div class="mb-2">
                    <span class="card-likes">{{ memo.likes }}</span>
                </div>

                <div>
                    <a href="/edit/{{ memo._id }}" class="btn btn-sm btn-outline-primary edit-button">ìˆ˜ì •</a>
                    <a href="/delete/{{ memo._id }}" class="btn btn-sm btn-outline-danger delete-button">ì‚­ì œ</a>
                    <a href="/like/{{ memo._id }}" class="link-like ms-2">ì¢‹ì•„ìš”! ğŸ‘</a>
                </div>
                {% endif %}

            </div>
        </div>
        {% endfor %}
    </div>
</div>
<script>
        // 1. PATCH ìš”ì²­ í•¨ìˆ˜
        function updateMemo(id) {
            const title = document.getElementById(`edit-title-${id}`).value;
            const content = document.getElementById(`edit-content-${id}`).value;

            fetch(`/update/${id}`, {
                method: 'PATCH',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: new URLSearchParams({
                    'title': title,
                    'content': content
                })
            }).then(response => {
                // ì„œë²„ì—ì„œ ë³´ë‚¸ redirect ì£¼ì†Œ(result í¬í•¨)ë¥¼ ì¸ì‹í•˜ì—¬ í˜ì´ì§€ ì´ë™
                if (response.redirected) {
                    window.location.href = response.url;
                } else {
                    window.location.reload();
                }
            }).catch(error => console.error('Error:', error));
        }
    </script>
</body>
</html>